下面我给你写一个 **最简单但完全可运行** 的 Express 项目示例，用来实现：

✔ 用户上传头像
✔ 用户上传文件（例如 PDF/word）
✔ 文件保存到 Express 项目的 uploads 文件夹
✔ 返回可访问的 URL
✔ 目录结构清晰，非常适合你项目直接使用

---

# ⭐ 一、项目目录结构（复制即可）

```
my-upload-project/
├─ uploads/           # 用于存储上传的文件
│  ├─ avatars/        # 存头像
│  └─ files/          # 存普通文件
├─ server.js          # 主服务文件
├─ package.json
```

---

# ⭐ 二、安装依赖

```bash
npm init -y
npm install express multer
```

---

# ⭐ 三、server.js（完整代码，可直接运行）

> 📌 **这是你需要的全部代码**
> 完全能运行，涵盖：上传头像、上传文件、返回 URL。

```js
const express = require('express');
const multer = require('multer');
const path = require('path');

const app = express();

// --------------------------------------
// 1. 静态资源托管（让 uploads 目录可访问）
// --------------------------------------
app.use('/uploads', express.static('uploads'));


// --------------------------------------
// 2. 配置头像上传 storage
// --------------------------------------
const avatarStorage = multer.diskStorage({
  destination(req, file, cb) {
    cb(null, 'uploads/avatars');
  },
  filename(req, file, cb) {
    const ext = path.extname(file.originalname);
    const fileName = Date.now() + '-' + Math.round(Math.random() * 1e9) + ext;
    cb(null, fileName);
  }
});

const uploadAvatar = multer({ storage: avatarStorage });


// --------------------------------------
// 3. 配置普通文件上传 storage
// --------------------------------------
const fileStorage = multer.diskStorage({
  destination(req, file, cb) {
    cb(null, 'uploads/files');
  },
  filename(req, file, cb) {
    const ext = path.extname(file.originalname);
    const fileName = Date.now() + '-' + Math.round(Math.random() * 1e9) + ext;
    cb(null, fileName);
  }
});

const uploadFile = multer({ storage: fileStorage });


// --------------------------------------
// 4. 上传头像接口
// --------------------------------------
app.post('/upload/avatar', uploadAvatar.single('avatar'), (req, res) => {
  const url = `/uploads/avatars/${req.file.filename}`;
  
  res.json({
    code: 200,
    message: '头像上传成功',
    url
  });
});


// --------------------------------------
// 5. 上传文件接口（PDF、Word 等）
// --------------------------------------
app.post('/upload/file', uploadFile.single('file'), (req, res) => {
  const url = `/uploads/files/${req.file.filename}`;
  
  res.json({
    code: 200,
    message: '文件上传成功',
    url
  });
});

// --------------------------------------
// 6. 启动服务
// --------------------------------------
app.listen(3000, () => {
  console.log('Server running at http://localhost:3000');
});
```

---

# ⭐ 四、前端 HTML 示例（你可以直接用来测试）

创建一个 `test.html` 文件进行测试：

```html
<h3>上传头像</h3>
<form action="http://localhost:3000/upload/avatar" method="POST" enctype="multipart/form-data">
  <input type="file" name="avatar" />
  <button>上传头像</button>
</form>

<h3>上传文件</h3>
<form action="http://localhost:3000/upload/file" method="POST" enctype="multipart/form-data">
  <input type="file" name="file" />
  <button>上传文件</button>
</form>
```

---

# ⭐ 五、运行步骤

1. 先创建目录：

```
uploads/
  avatars/
  files/
```

2. 启动服务：

```bash
node server.js
```

3. 打开 test.html 上传即可。

---

# ⭐ 六、上传结果示例

比如你上传头像成功后返回：

```json
{
  "code": 200,
  "message": "头像上传成功",
  "url": "/uploads/avatars/1731662519871-928371823.jpg"
}
```

前端可以直接访问：

```
http://localhost:3000/uploads/avatars/1731662519871-928371823.jpg
```

---

# ⭐ 七、你现在已经拥有完整可用项目

如果你需要，我还能给你继续扩展：

### 🔥 加入数据库存头像 URL（MongoDB 或 MySQL）

### 🔥 限制上传类型（只允许 jpg/png/PDF）

### 🔥 限制文件大小

### 🔥 Vue / React 前端的上传组件

### 🔥 用户资料修改 + 头像更新逻辑（旧头像删除）

你想继续扩展哪个？
