ä¸‹é¢ç»™ä½ ä¸€ä»½ **æœ€ç³»ç»Ÿã€æœ€æ¸…æ™°çš„ã€ŠMongoose åœ¨ Express ä¸­çš„ä½¿ç”¨å¤§å…¨ã€‹**ï¼Œå¹¶é…ä¸Šä¸€ä¸ª **ä» 0 åˆ° 1 çš„ç»å…¸é¡¹ç›®æ¡ˆä¾‹ï¼ˆç”¨æˆ·ç³»ç»Ÿï¼‰**ï¼ŒåŒ…å«ï¼š

âœ” æ•°æ®åº“è¿æ¥
âœ” Schema / Model
âœ” å¢åˆ æ”¹æŸ¥
âœ” åˆ†é¡µ
âœ” å…³è”æŸ¥è¯¢
âœ” ä¸­é—´ä»¶
âœ” æ ¡éªŒ
âœ” é”™è¯¯å¤„ç†
âœ” å¯†ç åŠ å¯†
âœ” JWT ç™»å½•
âœ” Express ç»“æ„åŒ–é¡¹ç›®
âœ” æœåŠ¡ç«¯è¿”å›æ ¼å¼æœ€ä½³å®è·µ

è¿™æ˜¯ä½ æœªæ¥åš **Node + Express + MongoDB** åç«¯é¡¹ç›®çš„æœ€é‡è¦çŸ¥è¯†æ€»ç»“ã€‚

---

# ğŸŸ¦ **ä¸€ã€é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆç»å…¸ Express + Mongoose é¡¹ç›®æ ‡å‡†ç»“æ„ï¼‰**

```
project/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ server.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ db.js
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ User.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ user.routes.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ user.controller.js
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â””â”€â”€ auth.js
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ response.js
â”‚
â””â”€â”€ package.json
```

è¿™æ˜¯ä¸“ä¸šåç«¯é¡¹ç›®é€šç”¨ç»“æ„ã€‚

---

# ğŸŸ¦ **äºŒã€å®‰è£…ä¾èµ–**

```bash
npm install express mongoose cors dotenv bcryptjs jsonwebtoken
npm install nodemon -D
```

---

# ğŸŸ© **ä¸‰ã€è¿æ¥ MongoDBï¼ˆconfig/db.jsï¼‰**

```js
import mongoose from "mongoose";

export const connectDB = async () => {
  try {
    await mongoose.connect("mongodb://127.0.0.1:27017/mydb");
    console.log("MongoDB connected!");
  } catch (err) {
    console.error("MongoDB connection error:", err);
    process.exit(1);
  }
};
```

---

# ğŸŸ¦ **å››ã€Express å¯åŠ¨å…¥å£ï¼ˆapp.js + server.jsï¼‰**

## app.js

```js
import express from "express";
import cors from "cors";
import userRouter from "./routes/user.routes.js";

const app = express();

app.use(cors());
app.use(express.json());

// è·¯ç”±
app.use("/api/users", userRouter);

export default app;
```

## server.js

```js
import app from "./app.js";
import { connectDB } from "./config/db.js";

connectDB();
app.listen(3000, () => console.log("Server running on http://localhost:3000"));
```

---

# ğŸŸ¦ **äº”ã€Mongoose Schema + Modelï¼ˆmodels/User.jsï¼‰**

ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„ **ç”¨æˆ·æ¨¡å‹ï¼ˆç»å…¸æ¡ˆä¾‹ï¼‰**ï¼š

```js
import mongoose from "mongoose";
import bcrypt from "bcryptjs";

const userSchema = new mongoose.Schema(
  {
    username: {
      type: String,
      required: true,
      minlength: 3,
      maxlength: 20,
      unique: true,
      trim: true,
    },
    email: {
      type: String,
      required: true,
      unique: true,
      match: /.+\@.+\..+/,
    },
    password: {
      type: String,
      required: true,
      minlength: 6,
    }
  },
  { timestamps: true } // createdAt, updatedAt è‡ªåŠ¨ç”Ÿæˆ
);

// ä¿å­˜ä¹‹å‰è‡ªåŠ¨åŠ å¯†å¯†ç 
userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();

  this.password = await bcrypt.hash(this.password, 10);
  next();
});

// æ ¡éªŒå¯†ç æ–¹æ³•
userSchema.methods.comparePassword = function (inputPwd) {
  return bcrypt.compare(inputPwd, this.password);
};

export default mongoose.model("User", userSchema);
```

---

# ğŸŸ§ **å…­ã€æ§åˆ¶å™¨ï¼šå®é™…å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ˆcontrollers/user.controller.jsï¼‰**

```js
import User from "../models/User.js";
import jwt from "jsonwebtoken";

export const register = async (req, res) => {
  try {
    const { username, email, password } = req.body;

    const exists = await User.findOne({ email });
    if (exists) return res.status(400).json({ msg: "é‚®ç®±å·²æ³¨å†Œ" });

    const user = await User.create({ username, email, password });

    res.json({ msg: "æ³¨å†ŒæˆåŠŸ", user });
  } catch (err) {
    res.status(500).json({ msg: "æœåŠ¡å™¨é”™è¯¯" });
  }
};

export const login = async (req, res) => {
  try {
    const { email, password } = req.body;

    const user = await User.findOne({ email });
    if (!user) return res.status(400).json({ msg: "ç”¨æˆ·ä¸å­˜åœ¨" });

    const match = await user.comparePassword(password);
    if (!match) return res.status(400).json({ msg: "å¯†ç é”™è¯¯" });

    const token = jwt.sign(
      { id: user._id },
      "SECRET_KEY",
      { expiresIn: "3d" }
    );

    res.json({
      msg: "ç™»å½•æˆåŠŸ",
      token,
      user: { id: user._id, username: user.username, email: user.email }
    });
  } catch (err) {
    res.status(500).json({ msg: "æœåŠ¡å™¨é”™è¯¯" });
  }
};

export const getUsers = async (req, res) => {
  const users = await User.find().select("-password");
  res.json(users);
};
```

---

# ğŸŸ¦ **ä¸ƒã€è·¯ç”±ï¼ˆroutes/user.routes.jsï¼‰**

```js
import express from "express";
import { register, login, getUsers } from "../controllers/user.controller.js";
import { auth } from "../middlewares/auth.js";

const router = express.Router();

router.post("/register", register);
router.post("/login", login);
router.get("/", auth, getUsers);

export default router;
```

---

# ğŸŸ© **å…«ã€JWT éªŒè¯ä¸­é—´ä»¶ï¼ˆmiddlewares/auth.jsï¼‰**

```js
import jwt from "jsonwebtoken";

export const auth = (req, res, next) => {
  const token = req.headers.authorization?.split(" ")[1];

  if (!token) return res.status(401).json({ msg: "æœªç™»å½•" });

  try {
    const decoded = jwt.verify(token, "SECRET_KEY");
    req.user = decoded;
    next();
  } catch (err) {
    res.status(401).json({ msg: "Token æ— æ•ˆ" });
  }
};
```

---

# ğŸŸ¦ **ä¹ã€Mongoose ç»å…¸ä½¿ç”¨å¤§å…¨ï¼ˆå…¨é¢æ€»ç»“ï¼‰**

## âœ” 1. åˆ›å»ºæ•°æ®

```js
await User.create({ username, email, password });
```

## âœ” 2. æŸ¥è¯¢æ•°æ®

```js
const user = await User.findOne({ email });
const users = await User.find().limit(10).skip(20);
```

### æ¨¡ç³ŠæŸ¥è¯¢

```js
User.find({ username: { $regex: keyword, $options: "i" } });
```

---

## âœ” 3. æ›´æ–°

```js
await User.findByIdAndUpdate(id, { username }, { new: true });
```

---

## âœ” 4. åˆ é™¤

```js
await User.findByIdAndDelete(id);
```

---

## âœ” 5. æ’åº & åˆ†é¡µ

```js
User.find()
  .sort({ createdAt: -1 })
  .skip((page - 1) * size)
  .limit(size);
```

---

## âœ” 6. å…³è”æŸ¥è¯¢ï¼ˆpopulateï¼‰

```js
Post.find().populate("author", "username email");
```

---

## âœ” 7. è‡ªå®šä¹‰å®ä¾‹æ–¹æ³• / é™æ€æ–¹æ³•

```js
userSchema.methods.xxx
userSchema.statics.xxx
```

---

## âœ” 8. ä¸­é—´ä»¶

* pre save
* post save
* pre find
* pre deleteOne

---

# ğŸŸ¦ **åã€å®Œæ•´ç»å…¸é¡¹ç›®ï¼ˆä» 0 â†’ ç™»å½• â†’ ç”¨æˆ·ç®¡ç†ï¼‰**

ä»¥ä¸Šä»£ç ç»„åˆèµ·æ¥ï¼Œå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼š

ğŸ’¡ **ç”¨æˆ·æ³¨å†Œ + ç™»å½• + JWT é‰´æƒ + æ•°æ®æŸ¥è¯¢ åç«¯ç³»ç»Ÿ**

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­æä¾›ï¼š

âœ… å‰ç«¯ React + Axios çš„ç™»å½•ç•Œé¢
âœ… Postman å…¨å¥—æµ‹è¯• API
âœ… å®Œæ•´é¡¹ç›®æ‰“åŒ…ç»™ä½ 
âœ… åŠ ä¸Š MongoDB å…³ç³»æ¨¡å‹è®¾è®¡ï¼ˆä¾‹å¦‚å¸–å­è¯„è®ºç³»ç»Ÿï¼‰
âœ… æ›´å¤æ‚çš„é¡¹ç›®ï¼ˆå¦‚åå°ç®¡ç†ç³»ç»Ÿ CRUDï¼‰

---

# ğŸ“Œ **ä½ æƒ³ä¸‹ä¸€ä¸ªå­¦ä»€ä¹ˆï¼Ÿ**

* ç»™ä½ ç”Ÿæˆå®Œæ•´å¯è¿è¡Œé¡¹ç›®ï¼Ÿ
* åŠ ä¸Šæ–‡ä»¶ä¸Šä¼ ï¼ˆMulterï¼‰ï¼Ÿ
* åŠ ä¸Šè§’è‰²æƒé™ï¼ˆAdminã€Userï¼‰ï¼Ÿ
* åŠ ä¸Šåˆ†é¡µã€æœç´¢ã€æ’åºï¼Ÿ

å‘Šè¯‰æˆ‘ä½ æƒ³æ‰©å±•å“ªä¸€éƒ¨åˆ†ï¼Œæˆ‘å¸®ä½ ç»§ç»­å†™ã€‚
