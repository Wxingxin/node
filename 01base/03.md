
éå¸¸æ£’ğŸ‘ï¼è¿™æ˜¯å­¦ä¹  **Node.js åç«¯æ ¸å¿ƒ** çš„å…³é”®é˜¶æ®µã€‚
æˆ‘ä»¬æ¥**ç³»ç»Ÿè®²é€ `request`ã€`response` å’Œ HTTP Header çš„å…¨éƒ¨çŸ¥è¯†ç‚¹ + å®æˆ˜ç¤ºä¾‹å¤§å…¨**ã€‚
è¿™éƒ¨åˆ†çŸ¥è¯†æŒæ¡äº†ï¼Œå°±å¯ä»¥ç‹¬ç«‹å†™å‡º **å®Œæ•´çš„ HTTP æœåŠ¡æ¥å£**ã€‚

---

## ğŸ§© ä¸€ã€HTTP åè®®ä¸ Node ä¸­çš„ `req` / `res` æ¦‚å¿µ

åœ¨ Node.js ä¸­ï¼Œ

* `req`ï¼ˆRequestï¼‰ä»£è¡¨**å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚å¯¹è±¡**
* `res`ï¼ˆResponseï¼‰ä»£è¡¨**æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”å¯¹è±¡**

HTTP æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªã€Œè¯·æ±‚ â†’ å“åº”ã€çš„è¿‡ç¨‹ã€‚

```
å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ã€Postmanç­‰ï¼‰
        â†“
     HTTP è¯·æ±‚
        â†“
     Node æœåŠ¡å™¨
        â†“
     å¤„ç†ä¸šåŠ¡é€»è¾‘
        â†“
     HTTP å“åº”
        â†“
     è¿”å›ç»™å®¢æˆ·ç«¯
```

---

## ğŸš€ äºŒã€Requestï¼ˆè¯·æ±‚å¯¹è±¡ reqï¼‰

`req` æ˜¯ Node æœåŠ¡å™¨ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„**æ‰€æœ‰è¯·æ±‚ä¿¡æ¯**ã€‚
å¸¸è§å±æ€§ä¸æ–¹æ³•å¦‚ä¸‹ ğŸ‘‡

### 1ï¸âƒ£ å¸¸è§å±æ€§è¡¨æ ¼

| å±æ€§                | ç±»å‹     | è¯´æ˜                          |
| ----------------- | ------ | --------------------------- |
| `req.method`      | String | è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETE ç­‰ï¼‰ |
| `req.url`         | String | è¯·æ±‚çš„è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°                  |
| `req.headers`     | Object | è¯·æ±‚å¤´ä¿¡æ¯                       |
| `req.httpVersion` | String | HTTP ç‰ˆæœ¬å·ï¼Œå¦‚ `1.1`            |
| `req.socket`      | Object | ä¸å®¢æˆ·ç«¯çš„ TCP è¿æ¥                |

---

### 2ï¸âƒ£ è·å– GET å‚æ•°ï¼ˆé€šè¿‡ URLï¼‰

```js
const http = require('http');
const url = require('url');

http.createServer((req, res) => {
  const parsedUrl = url.parse(req.url, true);
  console.log(parsedUrl.pathname); // è·¯å¾„
  console.log(parsedUrl.query);    // GET å‚æ•°å¯¹è±¡
  res.end('GET å‚æ•°å·²æ‰“å°');
}).listen(3000);
```

âœ… è®¿é—®
`http://localhost:3000/login?username=Tom&age=18`
æ§åˆ¶å°è¾“å‡ºï¼š

```js
{ username: 'Tom', age: '18' }
```

---

### 3ï¸âƒ£ è·å– POST å‚æ•°ï¼ˆé€šè¿‡ bodyï¼‰

POST è¯·æ±‚çš„ body æ˜¯**æ•°æ®æµï¼ˆstreamï¼‰**ï¼Œéœ€è¦è‡ªå·±æ‹¼æ¥ã€‚

```js
http.createServer((req, res) => {
  if (req.method === 'POST') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      console.log('æ”¶åˆ°çš„ POST æ•°æ®:', body);
      res.end('POST æ•°æ®å·²æ¥æ”¶');
    });
  } else {
    res.end('è¯·ä½¿ç”¨ POST è¯·æ±‚');
  }
}).listen(3000);
```

âœ… å¦‚æœå®¢æˆ·ç«¯å‘é€ï¼š

```json
{"username":"Tom","password":"123456"}
```

æ§åˆ¶å°è¾“å‡ºï¼š

```
æ”¶åˆ°çš„ POST æ•°æ®: {"username":"Tom","password":"123456"}
```

---

## ğŸ“¤ ä¸‰ã€Responseï¼ˆå“åº”å¯¹è±¡ resï¼‰

`res` è´Ÿè´£æŠŠæœåŠ¡å™¨çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹ ğŸ‘‡

| æ–¹æ³•                                   | è¯´æ˜           |
| ------------------------------------ | ------------ |
| `res.writeHead(statusCode, headers)` | è®¾ç½®çŠ¶æ€ç  + å“åº”å¤´  |
| `res.setHeader(name, value)`         | è®¾ç½®å•ä¸ªå“åº”å¤´      |
| `res.write(data)`                    | å‘é€å“åº”ä½“ï¼ˆå¯å¤šæ¬¡è°ƒç”¨ï¼‰ |
| `res.end([data])`                    | ç»“æŸå“åº”ï¼Œå¿…é¡»è°ƒç”¨    |

---

### 1ï¸âƒ£ è®¾ç½®çŠ¶æ€ç å’Œå“åº”å¤´

```js
res.writeHead(200, {
  'Content-Type': 'text/html; charset=utf-8'
});
res.end('<h1>ä½ å¥½ï¼Œä¸–ç•Œï¼</h1>');
```

### 2ï¸âƒ£ JSON å“åº”

```js
res.writeHead(200, {
  'Content-Type': 'application/json'
});
res.end(JSON.stringify({ code: 0, msg: 'æˆåŠŸ' }));
```

### 3ï¸âƒ£ è®¾ç½®è‡ªå®šä¹‰ Header

```js
res.setHeader('X-Powered-By', 'Node.js');
res.end('Header å·²è®¾ç½®');
```

> âš ï¸ æ³¨æ„ï¼š`res.setHeader()` è¦åœ¨ `res.end()` ä¹‹å‰è°ƒç”¨ã€‚

---

## ğŸ“¦ å››ã€HTTP Header è¯¦è§£ï¼ˆè¯·æ±‚å¤´ + å“åº”å¤´ï¼‰

HTTP Header æ˜¯å‰åç«¯é€šä¿¡ä¸­**æœ€é‡è¦çš„å…ƒæ•°æ®**ã€‚
å®ƒå‘Šè¯‰åŒæ–¹å¦‚ä½•è§£æè¯·æ±‚ä¸å“åº”ã€‚

---

### ğŸ“¨ 1ï¸âƒ£ è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰

ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ã€‚

| Header          | ä½œç”¨          | ç¤ºä¾‹                                                     |
| --------------- | ----------- | ------------------------------------------------------ |
| `Host`          | è¯·æ±‚çš„ä¸»æœºå      | `Host: localhost:3000`                                 |
| `User-Agent`    | å®¢æˆ·ç«¯ç±»å‹       | `User-Agent: Mozilla/5.0`                              |
| `Content-Type`  | è¯·æ±‚ä½“æ ¼å¼       | `application/json`ã€`application/x-www-form-urlencoded` |
| `Accept`        | æ¥å—çš„æ•°æ®ç±»å‹     | `Accept: application/json`                             |
| `Authorization` | é‰´æƒä»¤ç‰Œï¼ˆtokenï¼‰ | `Bearer xxxxxx`                                        |
| `Cookie`        | æºå¸¦ç™»å½•å‡­è¯      | `Cookie: sessionId=123`                                |

åœ¨ Node ä¸­æŸ¥çœ‹ï¼š

```js
console.log(req.headers);
console.log(req.headers['content-type']);
console.log(req.headers['authorization']);
```

---

### ğŸ“® 2ï¸âƒ£ å“åº”å¤´ï¼ˆResponse Headersï¼‰

ç”±æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

| Header                        | ä½œç”¨           | ç¤ºä¾‹                                |
| ----------------------------- | ------------ | --------------------------------- |
| `Content-Type`                | å‘Šè¯‰æµè§ˆå™¨å†…å®¹ç±»å‹    | `text/html; charset=utf-8`        |
| `Set-Cookie`                  | æœåŠ¡å™¨è®¾ç½® cookie | `Set-Cookie: token=123; HttpOnly` |
| `Cache-Control`               | ç¼“å­˜ç­–ç•¥         | `no-cache`, `max-age=3600`        |
| `Access-Control-Allow-Origin` | CORS è·¨åŸŸ      | `*` æˆ–æŒ‡å®šåŸŸå                         |
| `Location`                    | é‡å®šå‘åœ°å€        | `Location: /login`                |

è®¾ç½®ç¤ºä¾‹ï¼š

```js
res.writeHead(302, { 'Location': '/login' });
res.end();
```

---

## ğŸŒ äº”ã€CORSï¼ˆè·¨åŸŸç›¸å…³ Headerï¼‰

åœ¨æµè§ˆå™¨è¯·æ±‚ä¸åŒæºæ¥å£æ—¶ï¼ˆå¦‚ `localhost:3000` è°ƒç”¨ `localhost:4000`ï¼‰ï¼Œéœ€è¦ CORSï¼š

```js
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
```

âš ï¸ å¦‚æœæ˜¯å¤æ‚è¯·æ±‚ï¼ˆå¦‚å¸¦ token çš„ POSTï¼‰ï¼Œè¿˜éœ€å¤„ç†é¢„æ£€è¯·æ±‚ï¼š

```js
if (req.method === 'OPTIONS') {
  res.writeHead(204);
  res.end();
  return;
}
```

---

## ğŸ§  å…­ã€ç»¼åˆæ¡ˆä¾‹ï¼šNode åŸç”Ÿç™»å½•æ¥å£ï¼ˆPOSTï¼‰

```js
const http = require('http');

http.createServer((req, res) => {
  // è®¾ç½®åŸºç¡€å“åº”å¤´
  res.setHeader('Content-Type', 'application/json; charset=utf-8');
  res.setHeader('Access-Control-Allow-Origin', '*');

  // å¤„ç†ç™»å½•è¯·æ±‚
  if (req.url === '/login' && req.method === 'POST') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      const data = JSON.parse(body);
      const { email, password } = data;

      if (email === 'test@123.com' && password === '123456') {
        res.writeHead(200);
        res.end(JSON.stringify({ code: 0, msg: 'ç™»å½•æˆåŠŸ' }));
      } else {
        res.writeHead(401);
        res.end(JSON.stringify({ code: 1, msg: 'è´¦å·æˆ–å¯†ç é”™è¯¯' }));
      }
    });
  } else {
    res.writeHead(404);
    res.end(JSON.stringify({ msg: 'æ¥å£ä¸å­˜åœ¨' }));
  }
}).listen(3000, () => console.log('Server running on http://localhost:3000'));
```



## âœ… ä¸ƒã€æ€»ç»“é€Ÿè®°è¡¨

| æ¨¡å—     | å¸¸ç”¨æˆå‘˜                                                                            | åŠŸèƒ½           |
| ------ | ------------------------------------------------------------------------------- | ------------ |
| `req`  | `method` / `url` / `headers` / `on('data')` / `on('end')`                       | è·å–è¯·æ±‚ä¿¡æ¯       |
| `res`  | `writeHead()` / `write()` / `end()` / `setHeader()`                             | å“åº”å®¢æˆ·ç«¯        |
| Header | `Content-Type` / `Authorization` / `Set-Cookie` / `Access-Control-Allow-Origin` | æ§åˆ¶ HTTP é€šä¿¡è¡Œä¸º |

---

è¦ä¸è¦æˆ‘æ¥ä¸‹æ¥å¸®ä½ å†™ä¸€ä»½ï¼š

> ğŸ“˜ Node åŸç”Ÿç‰ˆã€Œæ³¨å†Œ + ç™»å½• + Token é‰´æƒã€å®Œæ•´åç«¯ï¼ˆå« MySQLï¼‰ï¼Ÿ

ä¼šç”¨åˆ°ä»Šå¤©è®²çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶å¸¦ä½ é€æ­¥å‡çº§åˆ° Express æ¡†æ¶ç‰ˆæœ¬ã€‚
